var originalUnit = preferences.rulerUnits;preferences.rulerUnits = Units.PIXELS;app.displayDialogs = DialogModes.NO;if(validateState()){	app.activeDocument.suspendHistory("Pixel Measure", "createMeasure();");}function validateState(){	if (app.documents.length == 0)	{		alert("No document open");		return false;	}	 	if(!hasSelection(app.activeDocument))	{		alert("Please make a selection to measure");		return false;	}		return true;}	function createMeasure(){	var docRef = app.activeDocument;	var selRef = docRef.selection;	var mainLayerSet;		// =======================================================	// Create "Pixel Measures" LayerSet if it doesn't already exist	// =======================================================	try	{		mainLayerSet = docRef.layerSets.getByName("Pixel Measures");	}	catch(error)	{		mainLayerSet = docRef.layerSets.add();		mainLayerSet.name = "Pixel Measures";	}	// =======================================================	// Create Measurement LayerSet	// =======================================================	var layerSetRef = mainLayerSet.layerSets.add() 	var linesLayerRef = layerSetRef.artLayers.add();	// =======================================================	// Draw Lines	// =======================================================	var x1 = selRef.bounds[0].value;	var y1 = selRef.bounds[1].value;	var x2 = selRef.bounds[2].value;	var y2 = selRef.bounds[3].value;	selRef.deselect();	var width = x2 - x1;	var height = y2 - y1;	var horizontal = width > height;	if(horizontal)	{		drawLine(x1,y1,x1,y1+10);		drawLine(x2-1,y1,x2-1,y1+10);		drawLine(x1,y1+5,x2-1,y1+5);	}	else	{		drawLine(x1,y1,x1+10,y1);		drawLine(x1,y2-1,x1+10,y2-1);		drawLine(x1+5,y1,x1+5,y2-1);	}	// =======================================================	// Draw Text	// =======================================================	var textLayerRef = layerSetRef.artLayers.add();	textLayerRef.kind = LayerKind.TEXT;	var textItemRef = textLayerRef.textItem;	if(horizontal)	{		textItemRef.contents = (width/2) + " px";		textItemRef.justification = Justification.CENTER;		textItemRef.position = Array(Math.floor(x1 + (width/2)),y1+21);	}	else	{		textItemRef.contents = (height/2) + " px";		textItemRef.position = Array(x1+15,Math.floor(y1 + 4 + (height/2)));	}	layerSetRef.name = textItemRef.contents;	textItemRef.color = app.foregroundColor;	textItemRef.font = "ArialMT";	textItemRef.size = 14;	// =======================================================	// Reset	// =======================================================	app.preferences.rulerUnits = originalUnit;}function drawLine(x1,y1,x2,y2){	var pointArray = new Array();	var pointA = new PathPointInfo();	pointA.kind = PointKind.CORNERPOINT;	pointA.anchor = Array(x1, y1);	pointA.leftDirection = pointA.anchor;	pointA.rightDirection = pointA.anchor;	pointArray.push(pointA);	var pointB = new PathPointInfo();	pointB.kind = PointKind.CORNERPOINT;	pointB.anchor = Array(x2, y2);	pointB.leftDirection = pointB.anchor;	pointB.rightDirection = pointB.anchor;	pointArray.push(pointB);	var line = new SubPathInfo();	line.operation = ShapeOperation.SHAPEXOR;	line.closed = false;	line.entireSubPath = pointArray;	var lineSubPathArray = new Array();	lineSubPathArray.push(line);	var linePath = app.activeDocument.pathItems.add("TempPath", lineSubPathArray);	linePath.strokePath(ToolType.PENCIL, false);	app.activeDocument.pathItems.removeAll();}function hasSelection(doc){	var res = false;	var as = doc.activeHistoryState;	doc.selection.deselect();	if (as != doc.activeHistoryState)	{		res = true;		doc.activeHistoryState = as;	}	return res;}